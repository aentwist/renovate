.not_scheduled: &not-scheduled
  rules:
    - if: $CI_PIPELINE_SOURCE != "schedule"

lint:code:
  image: python:3.12.2-slim-bookworm@sha256:36d57d7f9948fefe7b6092cfe8567da368033e71ba281b11bb9eeffce3d45bc6
  variables:
    PIP_CACHE_DIR: .cache/pip
    PRE_COMMIT_HOME: .cache/pre-commit
  cache:
    paths:
      - .cache
  stage: test
  before_script: |-
    apt update && apt install -y git
    pip install pre-commit==3.5.0
  script: pre-commit run --all-files prettier
  <<: *not-scheduled

lint:commits:
  image: node:20.11.1-alpine3.18@sha256:a02826c7340c37a29179152723190bcc3044f933c925f3c2d78abb20f794de3f
  cache:
    paths:
      - .npm
  stage: test
  # Versions should match pre-commit config
  before_script: npm i -g --cache .npm --prefer-offline commitlint@18.2.0 @commitlint/config-conventional@18.1.0
  script: commitlint --from
  <<: *not-scheduled
